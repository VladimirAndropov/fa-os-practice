<!DOCTYPE HTML>
<html lang="ru" class="sidebar-visible no-js light">
    
<!-- Mirrored from caos2023.myltsev.ru/lectures/08-call-ret/08-call-ret.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 15 Jan 2024 11:59:39 GMT -->
<head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>–ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã - HSE CAOS 2023</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="../../../cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJaxdda6.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../index.html";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../01-course.html">–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –∫—É—Ä—Å</a></li><li class="chapter-item expanded "><a href="../02-computers.html"><strong aria-hidden="true">1.</strong> –ö–æ–º–ø—å—é—Ç–µ—Ä—ã</a></li><li class="chapter-item expanded "><a href="../03-integers.html"><strong aria-hidden="true">2.</strong> –¶–µ–ª—ã–µ —á–∏—Å–ª–∞</a></li><li class="chapter-item expanded "><a href="../04-assembly.html"><strong aria-hidden="true">3.</strong> –Ø–∑—ã–∫ –∞—Å—Å–µ–º–±–ª–µ—Ä–∞</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../05-jumps.html"><strong aria-hidden="true">3.1.</strong> –ü–µ—Ä–µ—Ö–æ–¥—ã</a></li><li class="chapter-item expanded "><a href="../06-nand2cpu.html"><strong aria-hidden="true">3.2.</strong> –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å CPU –∏–∑ —Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä–æ–≤</a></li><li class="chapter-item expanded "><a href="../07-memory.html"><strong aria-hidden="true">3.3.</strong> –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø–∞–º—è—Ç–∏</a></li><li class="chapter-item expanded "><a href="08-call-ret.html" class="active"><strong aria-hidden="true">3.4.</strong> –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã</a></li><li class="chapter-item expanded "><a href="../09-elf/index.html"><strong aria-hidden="true">3.5.</strong> –ö–æ–º–ø–æ–Ω–æ–≤–∫–∞</a></li><li class="chapter-item expanded "><a href="../x1-cpu-internals/index.html"><strong aria-hidden="true">3.6.</strong> –í–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤</a></li></ol></li><li class="chapter-item expanded "><a href="../10-c/index.html"><strong aria-hidden="true">4.</strong> –Ø–∑—ã–∫ –°–∏</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../11-c-continued/index.html"><strong aria-hidden="true">4.1.</strong> –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å</a></li><li class="chapter-item expanded "><a href="../12-c-bit-twiddling/index.html"><strong aria-hidden="true">4.2.</strong> Bits and pieces</a></li></ol></li><li class="chapter-item expanded "><a href="../ipr/git.html"><strong aria-hidden="true">5.</strong> Git</a></li><li class="chapter-item expanded "><a href="../13-io/index.html"><strong aria-hidden="true">6.</strong> ¬´–°–∏—Å—Ç–µ–º–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ¬ª</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../interrupts/Interrupts.html"><strong aria-hidden="true">6.1.</strong> –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è</a></li><li class="chapter-item expanded "><a href="../15-rings/rings.html"><strong aria-hidden="true">6.2.</strong> –ö–æ–ª—å—Ü–∞ –∑–∞—â–∏—Ç—ã</a></li></ol></li><li class="chapter-item expanded "><a href="../16-files/index.html"><strong aria-hidden="true">7.</strong> –§–∞–π–ª—ã</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../17-file-system/index.html"><strong aria-hidden="true">7.1.</strong> –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞</a></li></ol></li><li class="chapter-item expanded "><a href="../18-floating-point-arithmetic/index.html"><strong aria-hidden="true">8.</strong> –í–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∏—Å–ª–∞</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../18-x86-floating-point/index.html"><strong aria-hidden="true">8.1.</strong> –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ x86: FPU, MMX, SSE, AVX</a></li></ol></li><li class="chapter-item expanded "><a href="../22-sockets/index.html"><strong aria-hidden="true">9.</strong> –°–µ—Ç–∏ –∏ —Å–æ–∫–µ—Ç—ã</a></li><li class="chapter-item expanded "><a href="../19-process/index.html"><strong aria-hidden="true">10.</strong> –ü—Ä–æ—Ü–µ—Å—Å—ã</a></li><li class="chapter-item expanded "><a href="../25-shared-mem/index.html"><strong aria-hidden="true">11.</strong> –†–∞–±–æ—Ç–∞ —Å –æ–±—â–µ–π –ø–∞–º—è—Ç—å—é</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../26-parallel-2/index.html"><strong aria-hidden="true">11.1.</strong> RMW</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">HSE CAOS 2023</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="lea"><a class="header" href="#lea"><code>lea</code></a></h2>
<p>Load effective address ‚Äî –Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø–∞–º—è—Ç–∏,
–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤ —Ä–µ–≥–∏—Å—Ç—Ä –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å:</p>
<pre><code class="language-x86asm">    lea 4(%esi, %edi, 8), %eax  // —Ç–µ–ø–µ—Ä—å eax = esi + 8*edi + 4

    lea (%eax, %eax, 8), %eax   // —É–º–Ω–æ–∂–∏–ª–∏ eax –Ω–∞ 9 ü§°
</code></pre>
<h2 id="–ü–µ—Ä–µ—Ö–æ–¥-–ø–æ-–∞–¥—Ä–µ—Å—É-–≤-—Ä–µ–≥–∏—Å—Ç—Ä–µ"><a class="header" href="#–ü–µ—Ä–µ—Ö–æ–¥-–ø–æ-–∞–¥—Ä–µ—Å—É-–≤-—Ä–µ–≥–∏—Å—Ç—Ä–µ">–ü–µ—Ä–µ—Ö–æ–¥ –ø–æ –∞–¥—Ä–µ—Å—É –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ</a></h2>
<pre><code class="language-x86asm">    jmp *%eax
</code></pre>
<p>–ù–∞–ø—Ä–∏–º–µ—Ä:</p>
<pre><code class="language-x86asm">somelabel:
    ...

    ...
    mov $somelabel, %eax
    jmp *%eax
</code></pre>
<p>–ò–ª–∏ —Ç–∞–∫:</p>
<pre><code class="language-x86asm">func1:
    ...
func2:
    ...

    .section .rodata
functable:
    .int func1
    .int func2

    .text
    ...
    mov functable + 4, %eax
    jmp *%eax
</code></pre>
<h2 id="–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ"><a class="header" href="#–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ">–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ</a></h2>
<p><img src="unaligned-read.png" alt="" /></p>
<p>–ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, <em>–ª—É—á—à–µ</em>, —á—Ç–æ–±—ã –º–Ω–æ–≥–æ–±–∞–π—Ç–æ–≤—ã–µ
–æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏ –±—ã–ª–∏ <em>–≤—ã—Ä–æ–≤–Ω–µ–Ω—ã</em> (aligned).</p>
<pre><code class="language-x86asm">    // –Ω–∞—á–∞–ª–æ —Å–µ–∫—Ü–∏–∏
    .byte 1
    .int 1    // —ç—Ç–∏ 4 –±–∞–π—Ç–∞ –ª–µ–∂–∞—Ç –ø–æ –∞–¥—Ä–µ—Å—É, –Ω–µ –∫—Ä–∞—Ç–Ω–æ–º—É 4

    .balign 4 // byte align: –∑–¥–µ—Å—å –¥–æ–±–∞–≤–∏—Ç 3 –±–∞–π—Ç–∞ –Ω—É–ª–µ–π
    .int 1    // —ç—Ç–∏ 4 –±–∞–π—Ç–∞ –ª–µ–∂–∞—Ç –ø–æ –∞–¥—Ä–µ—Å—É, –∫—Ä–∞—Ç–Ω–æ–º—É 4

    .balign 2 // –Ω–µ –¥–æ–±–∞–≤–∏—Ç –Ω–∏—á–µ–≥–æ
    .short 1
</code></pre>
<h2 id="–ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã"><a class="header" href="#–ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã">–ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã</a></h2>
<p>–ú—ã —Ö–æ—Ç–∏–º –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥ ‚Äî –≤—ã–∑—ã–≤–∞—Ç—å
–æ–¥–Ω—É –∏ —Ç—É –∂–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏–∑ —Ä–∞–∑–Ω—ã—Ö
—Ç–æ—á–µ–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã.</p>
<pre><code class="language-x86asm">double_eax:
    sal $1, %eax
    jmp ...  // –∫—É–¥–∞?
    

    ...
    jmp double_eax
    // —Ö–æ—Ç–∏–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–¥–µ—Å—å

    ...
    jmp double_eax
    // –∏–ª–∏ –∑–¥–µ—Å—å
</code></pre>
<p>–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ä–µ—à–∞—é—Ç —ç—Ç–æ —Å –ø–æ–º–æ—â—å—é
—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –¥–ª—è –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞.
–ï—Å–ª–∏ –±—ã —Ç–∞–∫–æ–π –±—ã–ª –≤ x86, –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã –º–æ–≥–ª–∏ –±—ã
–≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:</p>
<pre><code class="language-x86asm">double_eax:
    sal $1, %eax
    jmp *%return_address
    

    ...
    mov $1f, %return_address
    jmp double_eax
1:

    ...
    mov $1f, %return_address
    jmp double_eax
1:
</code></pre>
<p>–ù–æ –≤ x86 –ø—Ä–∏–Ω—è—Ç–æ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–ª–∞—Å—Ç—å –Ω–∞ —Å—Ç–µ–∫:</p>
<pre><code class="language-x86asm">double_eax:
    sal $1, %eax
    pop %edx        // –¥–æ—Å—Ç–∞—ë–º –∏–∑ —Å—Ç–µ–∫–∞ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
    jmp *%edx       // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ –Ω–µ–º—É
    

    ...
    push $1f        // –∫–ª–∞–¥—ë–º –≤ —Å—Ç–µ–∫ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
                    // (–∞–¥—Ä–µ—Å —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ—Å–ª–µ jmp)
    jmp double_eax  // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–∞—á–∞–ª–æ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã
1:

    ...
    push $1f
    jmp double_eax
1:
</code></pre>
<p>–î–ª—è —ç—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–≤—Ö–æ–¥ –≤ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—É –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∏–∑ –Ω–µ—ë)
–µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ <code>call</code> –∏ <code>ret</code>:</p>
<pre><code class="language-x86asm">double_eax:
    sal $1, %eax
    ret             // –¥–æ—Å—Ç–∞—ë–º –∏–∑ —Å—Ç–µ–∫–∞ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
                    // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ –Ω–µ–º—É
    

    ...
    call double_eax // –∫–ª–∞–¥—ë–º –≤ —Å—Ç–µ–∫ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
                    // (–∞–¥—Ä–µ—Å —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ—Å–ª–µ call)
                    // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–∞—á–∞–ª–æ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã

    ...
    call double_eax
</code></pre>
<p>–í –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–µ –≤–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –±–∞–ª–∞–Ω—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
<code>push</code> –∏ <code>pop</code>, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–º–∞—Ö–Ω—É—Ç—å—Å—è –º–∏–º–æ –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞.</p>
<h2 id="–°–æ–≥–ª–∞—à–µ–Ω–∏—è-–æ-–≤—ã–∑–æ–≤–∞—Ö"><a class="header" href="#–°–æ–≥–ª–∞—à–µ–Ω–∏—è-–æ-–≤—ã–∑–æ–≤–∞—Ö">–°–æ–≥–ª–∞—à–µ–Ω–∏—è –æ –≤—ã–∑–æ–≤–∞—Ö</a></h2>
<p>–ß—Ç–æ–±—ã —Ä–∞–∑–Ω—ã–µ –ª—é–¥–∏ (–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—ã) –º–æ–≥–ª–∏ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å
–ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã, –∏–º –Ω—É–∂–Ω–æ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è, –∫–∞–∫ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å
–≤ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–∞–∫ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∫–∞–∫–∏–µ
—Ä–µ–≥–∏—Å—Ç—Ä—ã –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –±—É–¥–µ—Ç –ø–æ—Ä—Ç–∏—Ç—å. –¢–∞–∫–∏–µ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏
–Ω–∞–∑—ã–≤–∞—é—Ç—Å—è <em>—Å–æ–≥–ª–∞—à–µ–Ω–∏—è–º–∏ –æ –≤—ã–∑–æ–≤–∞—Ö</em> (calling conventions).</p>
<p>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –Ω–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ (Linux/x86)
–Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è <a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cdecl">cdecl</a>:</p>
<ul>
<li>–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Å—Ç–µ–∫–µ, –ø—Ä–∏—á—ë–º –ª–µ–∂–∞—Ç –≤ –ø–∞–º—è—Ç–∏
¬´–ø–æ –ø–æ—Ä—è–¥–∫—É¬ª (–∞–¥—Ä–µ—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –Ω–æ–º–µ—Ä–æ–º –∞—Ä–≥—É–º–µ–Ω—Ç–∞);</li>
<li>–ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–¥–∞–ª—è–µ—Ç –∏–∑ —Å—Ç–µ–∫–∞ —Ç–æ—Ç, –∫—Ç–æ –∏—Ö —Ç—É–¥–∞ –ø–æ–ª–æ–∂–∏–ª
(—Ç–æ –µ—Å—Ç—å –≤—ã–∑—ã–≤–∞—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è);</li>
<li>–≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ eax
(–∞ 64-–±–∏—Ç–Ω–æ–µ ‚Äî –≤ –ø–∞—Ä–µ <code>eax:edx</code>);</li>
<li>caller-saved —Ä–µ–≥–∏—Å—Ç—Ä—ã: eax, ecx –∏ edx;</li>
<li>callee-saved —Ä–µ–≥–∏—Å—Ç—Ä—ã: –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ.</li>
</ul>
<p>–í–æ–æ—Ä—É–∂—ë–Ω–Ω—ã–µ —ç—Ç–∏–º –∑–Ω–∞–Ω–∏–µ–º, –º—ã —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ–º –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
–Ω–∞ –°–∏ –∏ –±—ã—Ç—å –∏–º–∏ –≤—ã–∑–≤–∞–Ω—ã:</p>
<pre><code class="language-x86asm">    // int foobar(int a, int b)

    pushl b
    pushl a
    call foobar
    add $8, %esp

    // –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ª–µ–∂–∏—Ç –≤ %eax
</code></pre>
<pre><code class="language-x86asm">    // –≤–æ–∑–º–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ foobar
    .global foobar
foobar:
    // —Å–µ–π—á–∞—Å —Å—Ç–µ–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫: ra  a  b
    mov 4(%esp), %eax
    add 8(%esp), %eax
    ret
</code></pre>
<h2 id="–õ–æ–∫–∞–ª—å–Ω—ã–µ-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ"><a class="header" href="#–õ–æ–∫–∞–ª—å–Ω—ã–µ-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ">–õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ</a></h2>
<p>–ü–æ–¥ –Ω–∏—Ö –º—ã –≤—ã–¥–µ–ª—è–µ–º –º–µ—Å—Ç–æ –Ω–∞ —Å—Ç–µ–∫–µ:</p>
<pre><code class="language-x86asm">baz:
    sub $8, %esp   // –≤—ã–¥–µ–ª–∏–ª–∏ —Å–µ–±–µ 8 –±–∞–π—Ç, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ —á—Ç–æ
    push $0        // –≤—ã–¥–µ–ª–∏–ª–∏ —Å–µ–±–µ 4 –±–∞–π—Ç–∞, –≤ –∫–æ—Ç–æ—Ä—ã—Ö 0
    // —Å–µ–π—á–∞—Å —Å—Ç–µ–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫: 0  ?  ?  ra  arg1  arg2...
</code></pre>
<p>–ß—Ç–æ–±—ã –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ esp, –ø—Ä–∏–¥—ë—Ç—Å—è
–ø–æ–º–Ω–∏—Ç—å, –Ω–∞ —Å–∫–æ–ª—å–∫–æ –º—ã —ç—Ç–æ—Ç esp —Å–º–µ—Å—Ç–∏–ª–∏:</p>
<pre><code class="language-x86asm">    mov 16(%esp), %eax  // –¥–æ—Å—Ç–∞–ª–∏ –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç
</code></pre>
<h2 id="–°—Ç–µ–∫–æ–≤—ã–π-–∫–∞–¥—Ä"><a class="header" href="#–°—Ç–µ–∫–æ–≤—ã–π-–∫–∞–¥—Ä">–°—Ç–µ–∫–æ–≤—ã–π –∫–∞–¥—Ä</a></h2>
<p>–ü—Ä–∏–Ω—è—Ç–æ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é —Å–æ—Ö—Ä–∞–Ω—è—Ç—å esp –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ
ebp (base pointer), –∞ —Å–∞–º ebp —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Å—Ç–µ–∫–µ:</p>
<pre><code class="language-x86asm">quux:
    push %ebp
    mov %esp, %ebp

    /*
    stack layout:  oldebp  ra  arg1  arg2...
                   ‚Üë ebp
    
    arg1: 8(%ebp)
    arg2: 12(%ebp)...

    local var 1: -4(%ebp)
    local var 2: -8(%ebp)...
    */

    ...

    mov %ebp, %esp
    pop %ebp
    ret
</code></pre>
<p>–°—Ç–µ–∫–æ–≤—ã–π –∫–∞–¥—Ä (stack frame):</p>
<pre><code>    ‚îÇ   ...         ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ  saved ebp    ‚îÇ ‚óÑ‚îÄ‚îê
    ‚îÇ               ‚îÇ   ‚îÇ
    ‚îÇ               ‚îÇ   ‚îÇ
    ‚îÇ               ‚îÇ   ‚îÇ
    ‚îÇ  arg2         ‚îÇ   ‚îÇ
    ‚îÇ  arg1         ‚îÇ   ‚îÇ
    ‚îÇ  return addr  ‚îÇ   ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îÇ
ebp‚Üí‚îÇ  saved ebp    ‚îÇ ‚îÄ‚îÄ‚îò
    ‚îÇ  local1       ‚îÇ
esp‚Üí‚îÇ  local2       ‚îÇ
    ‚îÇ               ‚îÇ
</code></pre>
<h2 id="–¢–µ–∫—Å—Ç-–Ω–µ-—Ç–æ—Ç-–∫–æ—Ç–æ—Ä—ã–π-text-–∞-–Ω–∞—Å—Ç–æ—è—â–∏–π"><a class="header" href="#–¢–µ–∫—Å—Ç-–Ω–µ-—Ç–æ—Ç-–∫–æ—Ç–æ—Ä—ã–π-text-–∞-–Ω–∞—Å—Ç–æ—è—â–∏–π">–¢–µ–∫—Å—Ç (–Ω–µ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π <code>.text</code>, –∞ –Ω–∞—Å—Ç–æ—è—â–∏–π)</a></h2>
<p>–ö–æ–¥–∏—Ä–æ–≤–∫–∞ <a href="https://en.wikipedia.org/wiki/ASCII#Character_set">ASCII</a>.</p>
<pre><code class="language-x86asm">greeting:
    .byte 'H'  // —Ç–æ –∂–µ, —á—Ç–æ .byte 0x48
    .byte 'i'  // —Ç–æ –∂–µ, —á—Ç–æ .byte 0x69
    .byte ' '
    .ascii &quot;guy&quot;
    .asciz &quot;s&quot;  // —Ç–æ –∂–µ, —á—Ç–æ .ascii &quot;s\0&quot;

    .asciz &quot;Hi guys&quot;  // –µ—â—ë —Ä–∞–∑ —Ç–∞ –∂–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–π—Ç
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../07-memory.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../09-elf/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../07-memory.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../09-elf/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>

<!-- Mirrored from caos2023.myltsev.ru/lectures/08-call-ret/08-call-ret.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 15 Jan 2024 11:59:39 GMT -->
</html>
